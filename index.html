<!-- HANAVE IBMT Online Library Full System (Frontend + Backend Example with PHP & MySQL) -->

<!-- Database Setup (MySQL) -->
--
CREATE DATABASE hanave_library;

CREATE TABLE students (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    course VARCHAR(100)
);

CREATE TABLE staff (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL UNIQUE,
    password_hash VARCHAR(255) NOT NULL,
    role ENUM('admin','staff') NOT NULL
);

CREATE TABLE uploads (
    id INT AUTO_INCREMENT PRIMARY KEY,
    file_name VARCHAR(255) NOT NULL,
    uploaded_by INT NOT NULL,
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
--

<!-- PHP: db.php -->
<?php
$host = 'localhost';
$db = 'hanave_library';
$user = 'db_user';
$pass = 'db_password';
$dsn = "mysql:host=$host;dbname=$db;charset=utf8mb4";
try {
    $pdo = new PDO($dsn, $user, $pass);
    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
} catch (PDOException $e) {
    die("Database connection failed: " . $e->getMessage());
}
?>

<!-- PHP: login.php -->
<?php
session_start();
include 'db.php';

if($_SERVER['REQUEST_METHOD'] === 'POST') {
    $email = $_POST['email'];
    $password = $_POST['password'];

    // Check staff first (admin/staff)
    $stmt = $pdo->prepare("SELECT * FROM staff WHERE email = ?");
    $stmt->execute([$email]);
    $staff = $stmt->fetch(PDO::FETCH_ASSOC);

    if($staff && password_verify($password, $staff['password_hash'])){
        $_SESSION['user_id'] = $staff['id'];
        $_SESSION['role'] = $staff['role'];
        header('Location: admin_dashboard.php');
        exit();
    }

    // Check students
    $stmt = $pdo->prepare("SELECT * FROM students WHERE email = ?");
    $stmt->execute([$email]);
    $student = $stmt->fetch(PDO::FETCH_ASSOC);

    if($student && password_verify($password, $student['password_hash'])){
        $_SESSION['user_id'] = $student['id'];
        $_SESSION['role'] = 'student';
        header('Location: student_dashboard.php');
        exit();
    }

    $error = "Invalid email or password";
}
?>

<!-- PHP: admin_dashboard.php -->
<?php
session_start();
if(!isset($_SESSION['role']) || ($_SESSION['role'] != 'admin' && $_SESSION['role'] != 'staff')){
    header('Location: login.html'); exit();
}
include 'db.php';

if($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['pdf'])){
    $target_dir = "uploads/";
    $target_file = $target_dir . basename($_FILES["pdf"]["name"]);
    $fileType = strtolower(pathinfo($target_file,PATHINFO_EXTENSION));

    if($fileType != 'pdf'){
        $msg = "Only PDF files are allowed.";
    } else {
        if(move_uploaded_file($_FILES["pdf"]["tmp_name"], $target_file)){
            $stmt = $pdo->prepare("INSERT INTO uploads (file_name, uploaded_by) VALUES (?, ?)");
            $stmt->execute([basename($_FILES["pdf"]["name"]), $_SESSION['user_id']]);
            $msg = "PDF uploaded successfully.";
        } else {
            $msg = "Error uploading file.";
        }
    }
}
?>

<!-- HTML: admin_dashboard.php -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | HANAVE Online Library</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
<h2>Admin / Staff Dashboard</h2>
<?php if(isset($msg)) echo '<div class="alert alert-info">'.$msg.'</div>'; ?>
<form method="post" enctype="multipart/form-data">
<input type="file" name="pdf" class="form-control mb-3" required>
<button type="submit" class="btn btn-primary">Upload PDF</button>
</form>
<h3 class="mt-4">Uploaded PDFs</h3>
<ul>
<?php
$stmt = $pdo->query("SELECT * FROM uploads ORDER BY upload_date DESC");
while($row = $stmt->fetch(PDO::FETCH_ASSOC)){
    echo '<li><a href="uploads/'.$row['file_name'].'" target="_blank">'.$row['file_name'].'</a></li>';
}
?>
</ul>
</div>
</body>
</html>
